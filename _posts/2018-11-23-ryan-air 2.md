---
title: "Ryanair, Berlin, and Hamiltonian Cycles"
date: 2018-11-23 22:14:51 +0100
header-img: "/images/ryanair-flight-prices.png"
---
<link rel="stylesheet" href="/stylesheets/main.css"/>


Ryanair is a wonderful example of two extremes - it's one of the worst possible airlines that nickle and dimes you for everything, [treats its employees terrible](https://www.independent.co.uk/travel/news-and-advice/ryanair-strike-pilots-uk-ireland-flights-cancelled-why-latest-a8454161.html), and is rated [the worst European airline](https://www.independent.co.uk/travel/news-and-advice/worst-airline-which-ryanair-british-airways-survey-vueling-jet2-norwegian-united-singapore-airlines-a8113616.html). However, it has one thing going for it - it's **dirt** cheap.

<img src="/images/ryanair-flight-prices.png">
<p class="footnote">Flight prices around Christmas time out of Milan</p>

Some friends and I wanted to take a trip out of Venice right before Christmas. We didn't just want to do one city, though - wanted to do a few. The problem with Ryanair's site, though, is that it only tells you which airports a specific airport will fly to. This is great for round trip flights to a single destination, but means that it's a significant amount of work to cross reference which city goes where.

For instance, our first thought was to go to Berlin. Great - Ryanair has a nonstop from Venice - Treviso to Berlin - Sch√∂nefeld. If we want to add another leg of the trip, which *then* proceeds to return to Venice - Treviso, we'd need to manually go through each of their lists 

The first step was to actually get the data from their site.

## Debugging their site

I was hoping for an `XHR` request that I could just copy and have the data in a nice JSON format. Unfortunately there was nothing like that - a few internationalization requests, but no `config` requests. The HTML contained a log of `ng-` attributes, though, so I knew it was an angular app.

The front end clearly did some sort of filtering - if you selected a departure airport it would only show you available destinations. I thought I could just find the nodes state and extract it from there. 

<img src="/images/ryanair-filtered-flight.png">
<p class="footnote">Ryanair only shows you available destinations from your airport of choice</p>

Weirdly enough most of my Angular debugging extensions didn't work - they all said that the application was not an Angular app although it clearly was. I started poking through devtools, trying to figure out if they had somehow renamed the `ng` or `angular` instance. It was there but it still did not behave like an Angular app. They were using Angular 1.6.10, which is a fairly recent release, so I was perplexed. However, in the state there was a normal `ng-repeat` that iterated over a local variable coreList.

<img src="/images/ryanair-filtered-html.png">
<p class="footnote">There was a coreList state variable</p>

The HTML that constructed the list I traversed down the state tree until I found the `coreList` property, which contained all the airport keys and the locations to which they flew. From here I could build a graph representation of airport connections.

## Building out a graph model

First I had to store the information in a method that would be easily parsed and converted into a graph. The easiest would be to just have a map in which every key was an array of all the places that it could fly to.

```js
let mappings = {};

for (const airport of airports.allAirportsList) {
  let id = airport.id; //format airport:XYZ
  let ryanairId = id.split(":");
  if (ryanairId[0] === "airport") {
    let iata = ryanairId[1];
    if (!mappings.hasOwnProperty(iata)) {
      mappings[iata] = new Set();
    }
    let routes = airport.routes.filter(entry => {
      return entry.startsWith('airport');
    });

    routes.map(entry => entry.split(":")[1]);
    for (const route of routes) {
      mappings[iata].add(route.split(":")[1]);
    }
  }
}
```

I'm actually still not sure if this is a bidirectional graph - I don't know if Airport A flying to Airport B means that Airport B also flies to Airport A. For now I'll keep this as a directed graph. 

I decided to use [Cytoscape](https://cytoscape.org/) to actually visualize the results, as I'd used the library before. 

<div class="ryanair-graph" id="cy"></div>

Success! We could now visualize where each airport would travel to. This was significantly more than I was expecting - the graph is almost unusable there are so many connections (There are 4223 edges!) Next I needed to build a tool to look for cycles, 
## Deciding on cities

## Conclusion
<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
<script src="/js/cytoscape.js"></script>
<script src="/js/ryanair-graph.js"></script>